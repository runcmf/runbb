{# extends 'Layout.html.twig' #}

{{ fireHook('view.header.start') }}

<!DOCTYPE html>
<html lang="{{ trans('lang_identifier') }}">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
{% if is_indexed %}
    <meta name="robots" content="noindex, follow">
{% endif %}
    <title><?= Utils::generate_page_title($title, $page_number) ?></title>
    <link rel="shortcut icon" href="{{ baseStatic() }}/style/img/favicon.png" />
    <!-- Theme -->
    <link rel="stylesheet" type="text/css" href="{{ baseStatic() }}/style/themes/{{ style }}/style.css">

{% for type, items in assets if type != 'js' %}
<!-- {{ type|capitalize }} -->
    {% for item in items %}
        {% if item.params.type == 'text/javascript' %}
            <script {% for key, value in item.params %}{{ key }}={{ value }} {% endfor %}src="{{ baseStatic() }}/{{ item.file }}" /></script>
        {% else %}
<link {% for key, value in item.params %}{{ key }}={{ value }} {% endfor %}href="{{ baseStatic() }}/{{ item.file }}">
        {% endif %}
    {% endfor %}
{% endfor %}


{%  if admin_console %}
    {{ admStyle }}
{% endif %}


{% if required_fields is not empty %}
    <!-- Output JavaScript to validate form (make sure required fields are filled out) -->
    <script type="text/javascript">
        /* <![CDATA[ */
        function process_form(the_form)
        {
            var required_fields = {
            {{ required_fields|join(', ') }}
            };

                {# Output a JavaScript object with localised field names #}
//                    $tpl_temp = count($required_fields);
//                foreach ($required_fields as $elem_orig => $elem_trans) {
//                    echo "\"".$elem_orig.'": "'.addslashes(str_replace('&#160;', ' ', $elem_trans));
//                    if (--$tpl_temp) {
//                        echo "\", ";
//                    } else {
//                        echo "\"\n\t\t\t\t};\n";
//                    }
//                }

            if (document.all || document.getElementById)
            {
                for (var i = 0; i < the_form.length; ++i)
                {
                    var elem = the_form.elements[i];
                    if (elem.name && required_fields[elem.name] && !elem.value && elem.type && (/^(?:text(?:area)?|password|file)$/i.test(elem.type)))
                    {
                        alert('"' + required_fields[elem.name] + '" {{ trans('required field') }}');
                        elem.focus();
                        return false;
                    }
                }
            }
            return true;
        }
        /* ]]> */
    </script>

{% endif %}

{% if page_head is not empty %}
    {{ page_head|join("\n") }}
{% endif %}

{{ fireHook('view.header.before.head.tag') }}

</head>

<body id="pun{{ active_page }}"{% if focus_element %} onload="document.getElementById('{{ focus_element.0 }}').elements['{{ focus_element.1 }}'].focus();"{% endif %}>
    <header>
        <nav>
            <div class="container">
                <div class="phone-menu" id="phone-button">
                    <a class="button-phone"></a>
                </div>
                <div id="phone">
                    <div id="brdmenu" class="inbox">
                        <ul>
{# ninjaaaaaaaa!!! #}
                            {% set navlinks = [] %}
                            {% set navlinks = navlinks|merge([
                            '<li id="navindex"'
                            ~"#{ active_page == "index" ? ' class="isactive"' : '' }"
                            ~'>'
                            ~'<a href="'
                            ~"#{ urlBase() }"
                            ~'/forum">'
                            ~"#{ trans('Index') }"
                            ~'</a></li>'
                            ]) %}

{% if userGet('g_read_board') == '1' and userGet('g_view_users') == '1' %}
    {% set navlinks = navlinks | merge([
        '<li id="navuserlist"'
        ~"#{ active_page == "userlist" ? ' class="isactive"' : ''}"
        ~'>'
        ~'<a href="'
        ~"#{ pathFor('userList') }"
        ~'">'
        ~"#{ trans('User list') }"
        ~'</a></li>'
    ])
    %}
{% endif %}

{% if settings('o_rules') == '1' and
    (userGet('is_guest') or userGet('g_read_board') == '1' or settings('o_regs_allow') == '1') %}
    {% set navlinks = navlinks | merge([
        '<li id="navrules"'
        ~"#{ active_page == 'rules' ? ' class="isactive"' : ''}"
        ~'><a href="'
        ~"#{ pathFor('rules') }"
        ~'">'
        ~"#{ trans('Rules') }"
        ~'</a></li>'
    ])
    %}
{% endif %}

{% if userGet('g_read_board') == '1' and userGet('g_search') == '1' %}
    {% set navlinks = navlinks | merge([
        '<li id="navsearch"'
        ~"#{ active_page == 'search' ? ' class="isactive"' : ''}"
        ~'><a href="'
        ~"#{ pathFor('search') }"
        ~'">'
        ~"#{ trans('Search') }"
        ~'</a></li>'
    ])
    %}
{% endif %}

{% if userGet('is_guest') %}
    {% set navlinks = navlinks | merge([
        '<li id="navregister"'
        ~"#{ active_page == 'register' ? ' class="isactive"' : ''}"
        ~'><a href="'
        ~"#{ pathFor('register') }"
        ~'">'
        ~"#{ trans('Register') }"
        ~'</a></li>'
    ])
    %}
    {% set navlinks = navlinks | merge([
        '<li id="navlogin"'
        ~"#{ active_page == 'login' ? ' class="isactive"' : ''}"
        ~'><a href="'
        ~"#{ pathFor('login') }"
        ~'">'
        ~"#{ trans('Login') }"
        ~'</a></li>'
    ])
    %}
{% else %}
    {% set navlinks = navlinks | merge([
        '<li id="navprofile"'
        ~"#{ active_page == 'profile' ? ' class="isactive"' : ''}"
        ~'><a href="'
        ~"#{ pathFor('userProfile', {'id': userGet(id) }) }"
        ~'">'
        ~"#{ trans('Profile') }"
        ~'</a></li>'
    ])
    %}
    if (User::get()->is_admmod) {
        {% set navlinks = navlinks | merge([
            '<li id="navadmin"'
            ~"#{ active_page == 'admin' ? ' class="isactive"' : ''}"
            ~'><a href="'
            ~"#{ pathFor('adminIndex') }"
            ~'">'
            ~"#{ trans('Admin') }"
            ~'</a></li>'
        ])
        %}
    }
    {% set navlinks = navlinks | merge([
        '<li id="navlogout"><a href="'
        ~"#{ pathFor('logout', {'token': getToken() }) }"
        ~'">'
        ~"#{ trans('Logout') }"
        ~'</a></li>'
    ])
    %}
{% endif %}

{# Are there any additional navlinks we should insert into the array before imploding it?#}

{{ fireHook(['view.header.navlinks', []]) }}

{% set extraLinks = extraLinks|join([
"#{ settings('o_additional_navlinks') }",
{{ hooksLinks|join("\n") }}
])
%}

{% if userGet('g_read_board') == '1' and extraLinks is not empty %}
    {% if results = pregMatchAll('%([0-9]+)\s*=\s*(.*?)\n%s', extraLinks) is not empty %}
        {# Insert any additional links into the $links array (at the correct index)#}
        {#$num_links = count($results[1]);#}
        {#for ($i = 0; $i < $num_links; ++$i) {#}
            {#array_splice($navlinks, $results[1][$i], 0, ['<li id="navextra'.($i + 1).'"'.(($active_page == 'navextra'.($i + 1)) ? ' class="isactive"' : '').'>'.$results[2][$i].'</li>']);#}
        {#}#}
    {% endif %}
{% endif %}

{{ navlinks|joint(' ') }}

                        </ul>
                    </div>
                    <div class="navbar-right">
                        <form method="get" action="{{ pathFor('search') }}" class="nav-search">
                            <input type="hidden" name="action" value="search">
                            <input type="text" name="keywords" size="20" maxlength="100" placeholder="{{ trans('Search') }}">
                        </form>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container">
            <div class="container-title-status">
                <h1 class="title-site">
                    <a href="{{ urlBase() }}/forum" title="" class="site-name">
                        <p>{{ settings('o_board_title') }}</p>
                    </a>
                    <div id="brddesc">{{ settings('o_board_desc') }}</div>
                </h1>
                <div class="status-avatar">
                    <div id="brdwelcome" class="inbox">


{% if userGet('is_guest') %}
                        <p class="conl">{{ trans('Not logged in') }}</p>
{% else %}
            <ul class="conl">
                <li><span>{{ trans('Logged in as') }} <strong>{{ userGet('username') }}</strong></span></li>
                <li><span>{{ trans('Last visit') }} '. Container::get('utils')->format_time(User::get()->last_visit).'</span></li>


            {% if userGet('is_admmod') %}
                {% if settings('o_report_method')  == '0' or settings('o_report_method') == '2' %}
                    {% if has_reports %}
                        <li class="reportlink"><span><strong><a href="{{ pathFor('adminReports') }}">{{ trans('New reports') }}</a></strong></span></li>
                    {% endif %}
                {% endif %}
                {% if settings('o_maintenance') == '1' %}
                    <li class="maintenancelink"><span><strong><a href="{{ pathFor('adminMaintenance') }}">{{ trans('Maintenance mode enabled') }}</a></strong></span></li>
                {% endif %}
            {% endif %}

            {% set headerToplist = fireHook(['header.toplist', []]) %}
            {{ headerToplist|join('') }}

            </ul>
{% endif %}

{% if userGet('g_read_board') == '1' and userGet('g_search') == '1' %}
            <ul class="conr">
                <li><span>{{ trans('Topic searches') }}
            {% if userGet('is_guest') %}
                <a href="{{ pathFor('quickSearch', {'show': 'replies'}) }}" title="{{ trans('Show posted topics') }}">{{ trans('Posted topics') }}</a> |
                <a href="{{ pathFor('quickSearch', {'show': 'new'}) }}" title="{{ trans('Show new posts') }}">{{ trans('New posts header') }}</a> |
            {% endif %}
                <a href="{{ pathFor('quickSearch', {'show': 'recent'}) }}" title="{{ trans('Show active topics') }}">{{ trans('Active topics') }}</a> |
                <a href="{{ pathFor('quickSearch', {'show': 'unanswered'}) }}" title="{{ trans('Show unanswered topics') }}">{{ trans('Unanswered topics') }}</a>
                </li>
            </ul>
{% endif %}

{{ fireHook('view.header.brdwelcome') }}
                    <div class="clearer"></div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>

{% if userGet('g_read_board') == '1' and settings('o_announcement') == '1' %}
            <div id="announce" class="block">
                <div class="hd"><h2><span>{{ trans('Announcement') }}</span></h2></div>
                <div class="box">
                    <div id="announce-block" class="inbox">
                        <div class="usercontent">{{ settings('o_announcement_message') }}</div>
                    </div>
                </div>
            </div>
{% endif %}


{% if flashMessages is not empty %}
            <script type="text/javascript">
                window.onload = function() {
                    var flashMessage = document.getElementById('flashmsg');
                    flashMessage.className = 'flashmsg '+flashMessage.getAttribute('data-type')+' show';
                    setTimeout(function () {
                        flashMessage.className = 'flashmsg '+flashMessage.getAttribute('data-type');
                    }, 10000);
                    return false;
                }
            </script>
    {% for type, message in flashMessages %}
{{ dump(message) }}
            <div class="flashmsg info" data-type="{{ type }}" id="flashmsg">
                <h2>{{ trans('Info') }}
                    <span style="float:right;cursor:pointer"
                            onclick="document.getElementById('flashmsg').className = 'flashmsg';">&times;
                            </span>
                </h2>
                <p>{{ message.0 }}</p>
            </div>
    {% endfor %}
{% endif %}

        </div>
    </header>

    <section class="container">
        <div id="brdmain">

{{ fireHook('view.header.end') }}
